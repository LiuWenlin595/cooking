<!--pages/mealplan/mealplan.wxml-->
<view class="container">
  <!-- æ—¥æœŸé€‰æ‹© -->
  <view class="date-selector">
    <view class="date-nav" bindtap="prevDate">
      <text>â€¹</text>
    </view>
    <picker mode="date" value="{{selectedDate}}" bindchange="onDateChange">
      <view class="date-display">
        <text class="date-text">{{formattedDate}}</text>
        <text class="date-weekday">{{weekday}}</text>
      </view>
    </picker>
    <view class="date-nav" bindtap="nextDate">
      <text>â€º</text>
    </view>
  </view>

  <!-- ä»Šæ—¥è®¡åˆ’ -->
  <view class="card">
    <view class="card-title">
      <text>ä»Šæ—¥èœå•</text>
      <button class="btn-small" bindtap="addMealPlan">+ å®‰æ’</button>
    </view>

    <view class="meal-plan" wx:if="{{currentPlan}}">
      <!-- æ—©é¤ -->
      <view class="meal-section">
        <text class="meal-label">ğŸŒ… æ—©é¤</text>
        <view class="meal-recipes">
          <view class="recipe-tag" wx:for="{{currentPlan.breakfast}}" wx:key="id" bindtap="viewRecipe" data-id="{{item.id}}">
            {{item.name}}
          </view>
          <view class="recipe-tag add" wx:if="{{currentPlan.breakfast.length === 0}}" bindtap="addMeal" data-type="breakfast">
            + æ·»åŠ 
          </view>
        </view>
      </view>

      <!-- åˆé¤ -->
      <view class="meal-section">
        <text class="meal-label">â˜€ï¸ åˆé¤</text>
        <view class="meal-recipes">
          <view class="recipe-tag" wx:for="{{currentPlan.lunch}}" wx:key="id" bindtap="viewRecipe" data-id="{{item.id}}">
            {{item.name}}
          </view>
          <view class="recipe-tag add" wx:if="{{currentPlan.lunch.length === 0}}" bindtap="addMeal" data-type="lunch">
            + æ·»åŠ 
          </view>
        </view>
      </view>

      <!-- æ™šé¤ -->
      <view class="meal-section">
        <text class="meal-label">ğŸŒ™ æ™šé¤</text>
        <view class="meal-recipes">
          <view class="recipe-tag" wx:for="{{currentPlan.dinner}}" wx:key="id" bindtap="viewRecipe" data-id="{{item.id}}">
            {{item.name}}
          </view>
          <view class="recipe-tag add" wx:if="{{currentPlan.dinner.length === 0}}" bindtap="addMeal" data-type="dinner">
            + æ·»åŠ 
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="plan-actions">
        <button class="btn btn-primary" bindtap="createOrderFromPlan">ä¸€é”®ä¸‹å•</button>
        <button class="btn btn-secondary" bindtap="clearPlan">æ¸…ç©ºè®¡åˆ’</button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-plan" wx:else>
      <text>ä»Šæ—¥æš‚æ— å®‰æ’</text>
      <button class="btn btn-primary" bindtap="addMealPlan" style="margin-top: 20rpx;">å¼€å§‹å®‰æ’</button>
    </view>
  </view>

  <!-- æœ¬å‘¨è®¡åˆ’é¢„è§ˆ -->
  <view class="card" wx:if="{{weekPlans.length > 0}}">
    <view class="card-title">æœ¬å‘¨è®¡åˆ’</view>
    <view class="week-plan-list">
      <view class="week-plan-item" wx:for="{{weekPlans}}" wx:key="date">
        <text class="week-date">{{item.dateText}}</text>
        <text class="week-meals">{{item.mealCount}}é“èœ</text>
      </view>
    </view>
  </view>
</view>

<!-- é€‰æ‹©èœè°±å¼¹çª— -->
<view class="modal" wx:if="{{showRecipeModal}}" bindtap="closeRecipeModal">
  <view class="modal-content large" catchtap="stopPropagation">
    <view class="modal-title">é€‰æ‹©èœè°±</view>
    <scroll-view class="recipes-scroll" scroll-y="true">
      <view class="recipe-item" wx:for="{{recipes}}" wx:key="id" bindtap="selectRecipe" data-id="{{item.id}}">
        <image class="recipe-image" src="{{item.image || '/images/default-recipe.png'}}" mode="aspectFill"></image>
        <view class="recipe-info">
          <text class="recipe-name">{{item.name}}</text>
          <text class="recipe-category">{{item.category}}</text>
        </view>
      </view>
    </scroll-view>
    <view class="modal-actions">
      <button class="btn btn-secondary" bindtap="closeRecipeModal">å–æ¶ˆ</button>
    </view>
  </view>
</view>
