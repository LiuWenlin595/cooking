<!--pages/ingredient/ingredient.wxml-->
<view class="container">
  <!-- å¿«æ·æ“ä½œ -->
  <view class="action-bar">
    <button class="btn btn-primary" bindtap="addIngredient">+ æ·»åŠ é£Ÿæ</button>
    <button class="btn btn-success" bindtap="viewAvailableRecipes">æŸ¥çœ‹å¯åšèœè°±</button>
  </view>

  <!-- é£Ÿæåˆ—è¡¨ -->
  <view class="ingredient-list" wx:if="{{ingredients.length > 0}}">
    <view class="ingredient-item" wx:for="{{ingredients}}" wx:key="id">
      <view class="ingredient-info">
        <text class="ingredient-name">{{item.name}}</text>
        <view class="ingredient-details">
          <text class="ingredient-quantity">æ•°é‡: {{item.quantity}} {{item.unit || ''}}</text>
          <text class="ingredient-expiry" wx:if="{{item.expiryDate}}">
            ä¿è´¨æœŸ: {{item.expiryDate}}
            <text class="expiry-warning" wx:if="{{item.daysLeft !== undefined && item.daysLeft <= 3}}">
              ({{item.daysLeft <= 0 ? 'å·²è¿‡æœŸ' : 'è¿˜å‰©' + item.daysLeft + 'å¤©'}})
            </text>
          </text>
        </view>
      </view>
      <view class="ingredient-actions">
        <button class="btn-small" bindtap="editIngredient" data-id="{{item.id}}">ç¼–è¾‘</button>
        <button class="btn-small btn-danger" bindtap="deleteIngredient" data-id="{{item.id}}">åˆ é™¤</button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:else>
    <view class="empty-icon">ğŸ¥¬</view>
    <text>æš‚æ— é£Ÿæ</text>
    <button class="btn btn-primary" bindtap="addIngredient" style="margin-top: 30rpx;">æ·»åŠ ç¬¬ä¸€ä¸ªé£Ÿæ</button>
  </view>
</view>

<!-- æ·»åŠ /ç¼–è¾‘é£Ÿæå¼¹çª— -->
<view class="modal" wx:if="{{showModal}}" bindtap="closeModal">
  <view class="modal-content" catchtap="stopPropagation">
    <view class="modal-title">{{isEdit ? 'ç¼–è¾‘é£Ÿæ' : 'æ·»åŠ é£Ÿæ'}}</view>
    
    <view class="form-item">
      <text class="label">é£Ÿæåç§° <text class="required">*</text></text>
      <input class="input" value="{{currentIngredient.name}}" bindinput="onNameInput" placeholder="è¯·è¾“å…¥é£Ÿæåç§°" />
    </view>

    <view class="form-row">
      <view class="form-item-half">
        <text class="label">æ•°é‡</text>
        <input class="input" type="number" value="{{currentIngredient.quantity}}" bindinput="onQuantityInput" placeholder="0" />
      </view>
      <view class="form-item-half">
        <text class="label">å•ä½</text>
        <input class="input" value="{{currentIngredient.unit}}" bindinput="onUnitInput" placeholder="å¦‚ï¼šä¸ªã€æ–¤ã€kg" />
      </view>
    </view>

    <view class="form-item">
      <text class="label">ä¿è´¨æœŸ</text>
      <picker mode="date" value="{{currentIngredient.expiryDate}}" bindchange="onExpiryDateChange">
        <view class="picker">
          {{currentIngredient.expiryDate || 'è¯·é€‰æ‹©ä¿è´¨æœŸ'}}
        </view>
      </picker>
    </view>

    <view class="modal-actions">
      <button class="btn btn-secondary" bindtap="closeModal">å–æ¶ˆ</button>
      <button class="btn btn-primary" bindtap="saveIngredient">ä¿å­˜</button>
    </view>
  </view>
</view>

<!-- å¯åšèœè°±å¼¹çª— -->
<view class="modal" wx:if="{{showRecipesModal}}" bindtap="closeRecipesModal">
  <view class="modal-content large" catchtap="stopPropagation">
    <view class="modal-title">æ ¹æ®ç°æœ‰é£Ÿæå¯åšçš„èœè°±</view>
    <scroll-view class="recipes-scroll" scroll-y="true">
      <view class="recipe-item" wx:for="{{availableRecipes}}" wx:key="id" bindtap="viewRecipe" data-id="{{item.id}}">
        <image class="recipe-image" src="{{item.image || '/images/default-recipe.png'}}" mode="aspectFill"></image>
        <view class="recipe-info">
          <text class="recipe-name">{{item.name}}</text>
          <text class="recipe-category">{{item.category}}</text>
        </view>
      </view>
    </scroll-view>
    <view class="modal-actions">
      <button class="btn btn-secondary" bindtap="closeRecipesModal">å…³é—­</button>
    </view>
  </view>
</view>
